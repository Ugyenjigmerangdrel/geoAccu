<!DOCTYPE html>
<html>
  <head>
    <title>Geolocation Smoothing Example</title>
  </head>
  <body>
    <h1>Geolocation Smoothing</h1>
    <p>Click the button to start getting your current location:</p>
    <button onclick="startTracking()">Start Tracking</button>
    <p>Smoothed location:</p>
    <p id="smoothedLocation"></p>

    <script>
      let coordinateBuffer = []; // Buffer to store recent coordinates
      const bufferSize = 5; // Adjust the buffer size as needed
      let smoothedLocation = document.getElementById("smoothedLocation");

      function startTracking() {
        if ("geolocation" in navigator) {
          navigator.geolocation.watchPosition(updatePosition, showError);
        } else {
          smoothedLocation.textContent =
            "Geolocation is not supported in your browser.";
        }
      }

      function updatePosition(position) {
        // Add the new coordinates to the buffer
        coordinateBuffer.push(position.coords);

        // Maintain the buffer size
        if (coordinateBuffer.length > bufferSize) {
          coordinateBuffer.shift(); // Remove the oldest coordinate
        }

        // Calculate the average of the coordinates in the buffer
        const averageCoords = calculateAverageCoordinates(coordinateBuffer);

        smoothedLocation.textContent = `Smoothed Latitude: ${averageCoords.latitude}, Longitude: ${averageCoords.longitude}`;
      }

      function calculateAverageCoordinates(coordsArray) {
        const totalLat = coordsArray.reduce(
          (acc, coord) => acc + coord.latitude,
          0
        );
        const totalLng = coordsArray.reduce(
          (acc, coord) => acc + coord.longitude,
          0
        );
        const averageLat = totalLat / coordsArray.length;
        const averageLng = totalLng / coordsArray.length;

        return {
          latitude: averageLat,
          longitude: averageLng,
        };
      }

      function showError(error) {
        smoothedLocation.textContent = "Error: " + error.message;
      }
    </script>
  </body>
</html>
